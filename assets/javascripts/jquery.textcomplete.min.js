!function(t){"use strict";var e,r=void 0!==(e=t("<div></div>").css(["color"]).color)?function(t,e){return t.css(e)}:function(e,r){var a;return a={},t.each(r,function(t,r){a[r]=e.css(r)}),a},a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},i=/[&<>"'\/]/g,s=function(t){if(void 0!==t)return t.replace(i,function(t){return a[t]})},o=function(){var e,a,i,o;function n(s){var n,l;"static"===(l=s.css("position"))&&(l="relative"),n=t(e.wrapper).css(t.extend({},a.wrapper,r(s,i),{position:l})),this.textareaTop=parseInt(s.css("border-top-width")),this.$el=t(e.overlay).css(t.extend({},a.overlay,r(s,o),{top:this.textareaTop,right:parseInt(s.css("border-right-width")),bottom:parseInt(s.css("border-bottom-width")),left:parseInt(s.css("border-left-width"))})),this.$textarea=s.css(a.textarea),this.$textarea.wrap(n).before(this.$el),this.$textarea.origVal=s.val,this.$textarea.val=t.proxy(this.val,this),this.$textarea.on({"input.overlay":t.proxy(this.onInput,this),"change.overlay":t.proxy(this.onInput,this),"scroll.overlay":t.proxy(this.resizeOverlay,this),"resize.overlay":t.proxy(this.resizeOverlay,this)}),this.strategies=[]}return e={wrapper:'<div class="textoverlay-wrapper"></div>',overlay:'<div class="textoverlay"></div>'},a={wrapper:{margin:0,padding:0,overflow:"hidden"},overlay:{position:"absolute",color:"transparent","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden"},textarea:{background:"transparent",position:"relative",outline:0}},i=["display"],o=["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","font-family","font-weight","font-size","background-color"],t.extend(n.prototype,{val:function(t){return null==t?this.$textarea.origVal():this.setVal(t)},setVal:function(t){return this.$textarea.origVal(t),this.renderTextOnOverlay(),this.$textarea},onInput:function(t){this.renderTextOnOverlay()},renderTextOnOverlay:function(){var e,r,a,i,o,n;for(r=0,e=t("<div></div>").text(this.$textarea.val()),a=this.strategies.length;r<a;r++)o=(i=this.strategies[r]).match,t.isArray(o)&&(o=RegExp("("+(o=t.map(o,function(t){return t.replace(/(\(|\)|\|)/g,"$1")})).join("|")+")","g")),n="background-color:"+i.css["background-color"],e.contents().each(function(){var e,r,a,i;if(this.nodeType==Node.TEXT_NODE){for(e=this.textContent,r="",i=o.lastIndex=0;;i=o.lastIndex){if(!(a=o.exec(e))){i&&(r+=s(e.substr(i)));break}a=a[0],r+=s(e.substr(i,o.lastIndex-i-a.length)),r+='<span style="'+n+'">'+s(a)+"</span>"}i&&t(this).replaceWith(r)}});return this.$el.html(e.contents()),this},resizeOverlay:function(){this.$el.css({top:this.textareaTop-this.$textarea.scrollTop()})},register:function(e){return e=t.isArray(e)?e:[e],this.strategies=this.strategies.concat(e),this.renderTextOnOverlay()},destroy:function(){var t;this.$textarea.off(".overlay"),(t=this.$textarea.parent()).after(this.$textarea).remove(),this.$textarea.removeData("overlay"),this.$textarea=null}}),n}();t.fn.overlay=function(e){var r;return(r="overlay","destroy"===e)?this.each(function(){var e=t(this).data(r);e&&e.destroy()}):this.each(function(){var a,i;(i=(a=t(this)).data(r))||(i=new o(a),a.data(r,i)),i.register(e)})}}(window.jQuery);
